generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  userId              Int                   @id @default(autoincrement())
  email               String
  passwordHash        String
  firstName           String?
  lastName            String?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  role                String?
  isVerified          Int?
  project             String                @default("document-parser")
  conversations       conversations[]
  files               files[]
  messages            messages[]
  processed_documents processed_documents[]
  userOtp             userOtp[]

  @@unique([email, project])
}

model conversations {
  id                  String               @id
  title               String
  fileId              String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime
  userId              Int?
  documentId          String?
  processed_documents processed_documents? @relation(fields: [documentId], references: [id])
  files               files?               @relation(fields: [fileId], references: [id])
  User                User?                @relation(fields: [userId], references: [userId])
  messages            messages[]
}

model files {
  id             String          @id
  url            String          @unique
  fileName       String
  fileType       String
  pageCount      Int?
  size           Int?
  sourceUrl      String?
  sourceFileName String?
  uploadedAt     DateTime        @default(now())
  updatedAt      DateTime
  userId         Int?
  conversations  conversations[]
  User           User?           @relation(fields: [userId], references: [userId])
}

model messages {
  id             String        @id
  conversationId String
  role           String
  content        String
  createdAt      DateTime      @default(now())
  userId         Int?
  conversations  conversations @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  User           User?         @relation(fields: [userId], references: [userId])
}

model processed_documents {
  id             String          @id
  fileName       String
  fileUrl        String
  chunkCount     Int
  pageCount      Int?
  sourceUrl      String?
  sourceFileName String?
  processedAt    DateTime        @default(now())
  userId         Int?
  conversations  conversations[]
  User           User?           @relation(fields: [userId], references: [userId])
}

model userOtp {
  id                  Int      @id @default(autoincrement())
  otp                 String   @unique
  isUsed              Int
  generatedTimestamp  DateTime
  expirationTimestamp DateTime
  userId              Int
  User                User     @relation(fields: [userId], references: [userId])
}
